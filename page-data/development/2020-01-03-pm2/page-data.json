{"componentChunkName":"component---src-templates-blog-post-js","path":"/development/2020-01-03-pm2/","result":{"data":{"site":{"siteMetadata":{"title":"TIL","author":"[Suho]","siteUrl":"https://gatsby-starter-bee.netlify.com","comment":{"disqusShortName":"","utterances":"angelxtry/blog-comment"},"sponsor":{"buyMeACoffeeId":""}}},"markdownRemark":{"id":"8c83a25e-e746-5c39-9152-3e2f8ffc3ecd","excerpt":"자주 사용하고 있는 pm2. 매번 사용하던 대로만 사용하고, 모르는 것은 동일한 내용을 매번 검색하고 있어, 한번 정리하고 넘어가려고 한다.  PM2를 사용하는 가장 큰 이유는 내가 만든 프로그램을 daemon으로 만드는 것이고, 두 번째는 예상치 못한 오류가 발생하여 process…","html":"<p>자주 사용하고 있는 pm2. 매번 사용하던 대로만 사용하고, 모르는 것은 동일한 내용을 매번 검색하고 있어, 한번 정리하고 넘어가려고 한다.</p>\n<p><code class=\"language-text\">PM2 is a daemon process manager</code></p>\n<p>PM2를 사용하는 가장 큰 이유는 내가 만든 프로그램을 daemon으로 만드는 것이고, 두 번째는 예상치 못한 오류가 발생하여 process가 중단되었을 때 자동으로 재시작하는 것이다.</p>\n<h2 id=\"자주-사용하는-것\"><a href=\"#%EC%9E%90%EC%A3%BC-%EC%82%AC%EC%9A%A9%ED%95%98%EB%8A%94-%EA%B2%83\" aria-label=\"자주 사용하는 것 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>자주 사용하는 것</h2>\n<p><a href=\"https://pm2.keymetrics.io/docs/usage/quick-start/#start-an-app\">공식 페이지</a>에 보면 사용법과 간단한 옵션을 설명한다.</p>\n<p>자주 사용하는 것을 추려보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"cmd\"><pre class=\"language-cmd\"><code class=\"language-cmd\">pm2 start app.js</code></pre></div>\n<p><code class=\"language-text\">pm2 list</code> 등에서 확인할 수 있는 이름을 설정</p>\n<div class=\"gatsby-highlight\" data-language=\"cmd\"><pre class=\"language-cmd\"><code class=\"language-cmd\">--name &lt;app_name&gt;</code></pre></div>\n<p>파일이 변경되면 다시 시작. 사용해본 적이 없다;</p>\n<div class=\"gatsby-highlight\" data-language=\"cmd\"><pre class=\"language-cmd\"><code class=\"language-cmd\">--watch</code></pre></div>\n<p>정확하게 어떤 메모리를 얘기하는지는 잘 모르겠다. 이전 프로젝트 때 SSR이 적용된 front 프로그램이 메모리 leak이 발생해 시간이 지나면 서버가 다운되는 증상이 발생했었는데, 그 때 잘 써먹었다. 기억해두자.</p>\n<div class=\"gatsby-highlight\" data-language=\"cmd\"><pre class=\"language-cmd\"><code class=\"language-cmd\">--max-memory-restart &lt;200MB&gt;</code></pre></div>\n<p>이런 식으로 사용한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"cmd\"><pre class=\"language-cmd\"><code class=\"language-cmd\">pm2 start app.js --max-memory-restart 200M</code></pre></div>\n<p>로그 파일 생성. 로그는 다시 설명한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"cmd\"><pre class=\"language-cmd\"><code class=\"language-cmd\">--log &lt;log_path&gt;</code></pre></div>\n<p>script에 인자 전달하는 방법. 기억해두자. 종종 사용한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"cmd\"><pre class=\"language-cmd\"><code class=\"language-cmd\">-- arg1 arg2 arg3</code></pre></div>\n<h2 id=\"ecosystem\"><a href=\"#ecosystem\" aria-label=\"ecosystem permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ecosystem</h2>\n<p>CLI 방식으로만 사용하는 것이 아니라 batch file 처럼 실행 내용을 정의해두고 실행하는 방식도 있다. 아직까지는 package.json의 script에 다 처리할 수 있어서 사용해보지는 않았다.</p>\n<p>js, yaml 형식 등을 활용할 수 있다.</p>\n<p><code class=\"language-text\">js 포멧</code></p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">module<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  apps<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n      name<span class=\"token punctuation\">:</span> <span class=\"token string\">'app'</span><span class=\"token punctuation\">,</span>\n      script<span class=\"token punctuation\">:</span> <span class=\"token string\">'./app.js'</span><span class=\"token punctuation\">,</span>\n      env<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token constant\">NODE_ENV</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'development'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      env_production<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token constant\">NODE_ENV</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'production'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><code class=\"language-text\">yaml 포멧</code></p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apps</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">script</span><span class=\"token punctuation\">:</span> ./api.js\n    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'api-app'</span>\n    <span class=\"token key atrule\">instances</span><span class=\"token punctuation\">:</span> <span class=\"token number\">4</span>\n    <span class=\"token key atrule\">exec_mode</span><span class=\"token punctuation\">:</span> cluster\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">script</span><span class=\"token punctuation\">:</span> ./worker.js\n    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'worker'</span>\n    <span class=\"token key atrule\">watch</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n    <span class=\"token key atrule\">env</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">NODE_ENV</span><span class=\"token punctuation\">:</span> development\n    <span class=\"token key atrule\">env_production</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">NODE_ENV</span><span class=\"token punctuation\">:</span> production</code></pre></div>\n<p>다음과 같이 실행한다.</p>\n<p><code class=\"language-text\">pm2 start ecosystem.config.js</code></p>\n<p>production 모드로 실행</p>\n<p><code class=\"language-text\">pm2 start ecosystem.json --env production</code></p>\n<h2 id=\"현재-구성\"><a href=\"#%ED%98%84%EC%9E%AC-%EA%B5%AC%EC%84%B1\" aria-label=\"현재 구성 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>현재 구성</h2>\n<p>현재는 package.json 파일의 script를 활용하고 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token property\">\"start\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"NODE_ENV=production pm2 start ts-node -- src/index.ts &amp;&amp; pm2 monit\"</span><span class=\"token punctuation\">,</span></code></pre></div>\n<p><code class=\"language-text\">--</code>를 사용하여 args를 표현한다.</p>","frontmatter":{"title":"2020-01-03 pm2","date":"January 03, 2020"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/development/2020-01-03-pm2/","previous":{"fields":{"slug":"/development/2020-01-02-aws-server-replacement/"},"frontmatter":{"title":"2020-01-02  AWS 서버 교체","category":"development"}},"next":{"fields":{"slug":"/development/2020-01-03-typeorm-01-start/"},"frontmatter":{"title":"2020-01-03 TypeORM - 01 Start","category":"development"}}}}}