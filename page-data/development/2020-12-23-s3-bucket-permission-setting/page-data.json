{"componentChunkName":"component---src-templates-blog-post-js","path":"/development/2020-12-23-s3-bucket-permission-setting/","result":{"data":{"site":{"siteMetadata":{"title":"TIL","author":"[Suho]","siteUrl":"https://gatsby-starter-bee.netlify.com","comment":{"disqusShortName":"","utterances":"angelxtry/blog-comment"},"sponsor":{"buyMeACoffeeId":""}}},"markdownRemark":{"id":"8b00b6c7-3877-5016-832d-61c75b3fa395","excerpt":"why? 특정 S3 bucket에 특정 그룹의 유저만 접속해야 한다. 해당 그룹은 데이터 조회, 업로드, 삭제 권한이 필요하다. 해당 그룹은 해당 bucket 이외의 bucket을 조회하지 못한다. how? 둘 중 하나를 선택하거나 둘을 조합하여 사용한다. 1 S3의 특정 bucket에 bucket policy를 설정한다. 2 IAM의 policy를 생성하여 해당 그룹에 적용한다. question S3 bucket policy가 무엇인가요? IAM은 무엇의 약자인가요? IAM의 policy…","html":"<h2 id=\"why\" style=\"position:relative;\"><a href=\"#why\" aria-label=\"why permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>why?</h2>\n<ul>\n<li>특정 S3 bucket에 특정 그룹의 유저만 접속해야 한다.</li>\n<li>해당 그룹은 데이터 조회, 업로드, 삭제 권한이 필요하다.</li>\n<li>해당 그룹은 해당 bucket 이외의 bucket을 조회하지 못한다.</li>\n</ul>\n<h2 id=\"how\" style=\"position:relative;\"><a href=\"#how\" aria-label=\"how permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>how?</h2>\n<p>둘 중 하나를 선택하거나 둘을 조합하여 사용한다.</p>\n<ul>\n<li>1 S3의 특정 bucket에 bucket policy를 설정한다.</li>\n<li>2 IAM의 policy를 생성하여 해당 그룹에 적용한다.</li>\n</ul>\n<h2 id=\"question\" style=\"position:relative;\"><a href=\"#question\" aria-label=\"question permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>question</h2>\n<ul>\n<li>S3 bucket policy가 무엇인가요?</li>\n<li>IAM은 무엇의 약자인가요?</li>\n<li>IAM의 policy의 주요 key는 무엇이 있나요?</li>\n<li>S3의 특정 bucket에 특정 그룹만 권한을 주려면 어떻게 해야 할까요?</li>\n</ul>\n<h2 id=\"detail\" style=\"position:relative;\"><a href=\"#detail\" aria-label=\"detail permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>detail</h2>\n<p>S3의 특정 bucket에 허가된 유저들만 접속하여 데이터 업로드, 삭제를 가능하게 할 필요가 생겼다.</p>\n<p>당연히 가능할 것이라고 생각했지만 방법을 잘 몰라서 검색 후 적용했다.</p>\n<p>방식은 2가지가 있었는데 특정 그룹을 생성하여 유저들을 해당 그룹에 포함시키고, 해당 그룹에 bucket에 대한 권한을 부여했다.</p>\n<p>권한을 부여하기 위해서 IAM policy를 생성했다.</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"Version\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2012-10-17\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"Statement\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token property\">\"Sid\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"AllowListBucket\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"Effect\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Allow\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"Action\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n                <span class=\"token string\">\"s3:ListBucket\"</span>\n            <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"Resource\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"arn:aws:s3:::[BUCKET_NAME]\"</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token property\">\"Sid\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"AllowObjectAccess\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"Effect\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Allow\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"Action\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n                <span class=\"token string\">\"s3:PutObject\"</span><span class=\"token punctuation\">,</span>\n                <span class=\"token string\">\"s3:GetObject\"</span><span class=\"token punctuation\">,</span>\n                <span class=\"token string\">\"s3:DeleteObject\"</span>\n            <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"Resource\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"arn:aws:s3:::[BUCKET_NAME]/[FOLDER]/*\"</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>IAM policy는 크게 Version, Statement로 구성된다. Statement는 Sid, Effect, Action, Resource, Principal로 구성된다.(각 항목은 하단에서 다시 설명한다.)</p>\n<p>위와 같이 설정하면 console로 AWS에 접속하여 S3의 bucket 목록조차 확인할 수 없게 된다.</p>\n<p>그래서 브라우저에 해당 bucket의 주소를 입력하여 접속해야 한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">https<span class=\"token operator\">:</span><span class=\"token operator\">/</span><span class=\"token operator\">/</span>s3<span class=\"token punctuation\">.</span>console<span class=\"token punctuation\">.</span>aws<span class=\"token punctuation\">.</span>amazon<span class=\"token punctuation\">.</span>com<span class=\"token operator\">/</span>s3<span class=\"token operator\">/</span>bucket<span class=\"token operator\">/</span><span class=\"token punctuation\">[</span><span class=\"token constant\">BUCKET_NAME</span><span class=\"token punctuation\">]</span></code></pre></div>\n<p>해당 bucket에 접속하면 하위 폴더들을 확인할 수 있다.</p>\n<p>특정 폴더에 <code class=\"language-text\">s3:PutObject</code>, <code class=\"language-text\">s3:GetObject</code>, <code class=\"language-text\">s3:DeleteObjec</code> 권한을 부여면 파일을 업로드, 삭제까지 가능하다.</p>\n<p>단, Bucket Versioning을 enable 해 두었다면 파일을 삭제할 때 오류가 발생한다. 하지만 파일을 정상적으로 삭제된다.</p>\n<h2 id=\"policy-용어-설명\" style=\"position:relative;\"><a href=\"#policy-%EC%9A%A9%EC%96%B4-%EC%84%A4%EB%AA%85\" aria-label=\"policy 용어 설명 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Policy 용어 설명</h2>\n<p>Version</p>\n<ul>\n<li>IAM policy json 문서 양식 버전</li>\n<li><code class=\"language-text\">2020-10-17</code>을 디폴트 처럼 사용한다.</li>\n</ul>\n<p>Statement</p>\n<ul>\n<li>상세 규칙을 기술한다.</li>\n</ul>\n<p>Sid</p>\n<ul>\n<li>unique id</li>\n</ul>\n<p>Effect</p>\n<ul>\n<li><code class=\"language-text\">Allow</code>, <code class=\"language-text\">Deny</code></li>\n</ul>\n<p>Action</p>\n<ul>\n<li><code class=\"language-text\">서비스:작업</code></li>\n<li>ex: <code class=\"language-text\">s3:PutObject</code></li>\n</ul>\n<p>Resource</p>\n<ul>\n<li>해당 Statement에서 관리하는 객체</li>\n<li>ARN을 사용하여 지정한다.</li>\n</ul>\n<p>Principal</p>\n<ul>\n<li>보안 주체</li>\n<li>IAM의 identity-based policy에서는 사용하지 않는다.</li>\n</ul>\n<h2 id=\"answer\" style=\"position:relative;\"><a href=\"#answer\" aria-label=\"answer permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>answer</h2>\n<ul>\n<li>\n<p>S3 bucket policy는 왜 사용하나요?</p>\n<ul>\n<li>S3 리소스에 권한을 부여하기 위해 사용. JSON-baesd access policy language를 사용한다.</li>\n</ul>\n</li>\n<li>\n<p>IAM은 무엇의 약자인가요?</p>\n<ul>\n<li>Identity and Access Management</li>\n</ul>\n</li>\n<li>\n<p>IAM의 policy의 주요 key는 무엇이 있나요?</p>\n<ul>\n<li>크게 Version, Statement로 구성된다.</li>\n<li>Statement는 Sid, Effect, Action, Resource, Principal로 구성된다.</li>\n</ul>\n</li>\n<li>\n<p>S3의 특정 bucket에 특정 그룹만 권한을 주려면 어떻게 해야 할까요?</p>\n<ul>\n<li>S3의 특정 bucket에 bucket policy를 설정한다.</li>\n<li>IAM의 policy를 생성하여 해당 그룹에 적용한다.</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"참고자료\" style=\"position:relative;\"><a href=\"#%EC%B0%B8%EA%B3%A0%EC%9E%90%EB%A3%8C\" aria-label=\"참고자료 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>참고자료</h2>\n<p><a href=\"https://musma.github.io/2019/11/05/about-aws-iam-policy.html\">https://musma.github.io/2019/11/05/about-aws-iam-policy.html</a></p>","frontmatter":{"title":"S3 bucket 권한 설정","date":"December 23, 2020"}}},"pageContext":{"slug":"/development/2020-12-23-s3-bucket-permission-setting/","previous":{"fields":{"slug":"/blog/2020-12-21-short-record-output-learning-method/"},"frontmatter":{"title":"2020-12-21 아웃풋 중심 학습법","category":"blog"}},"next":{"fields":{"slug":"/til/2020-12-29-til/"},"frontmatter":{"title":"2020-12-29 TIL","category":"til"}}}},"staticQueryHashes":["3128451518","96099027"]}